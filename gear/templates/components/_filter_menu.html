{% load static %}

<meta name="turbolinks-cache-control" content="no-cache" />

<style>
  .loading-bar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(to right, #10b981, #34d399);
    animation: loading 1.5s infinite;
    z-index: 9999;
  }
  
  @keyframes loading {
    0% {
      width: 0%;
    }
    50% {
      width: 100%;
    }
    100% {
      width: 0%;
    }
  }
  
  /* Remove custom filter option styles */
  /* .filter-box ... */
  /* .filter-options ... */
  /* .filter-option ... */
  /* .filter-option:hover ... */
  /* .filter-option.active ... */
  
  /* Hide content frame */
  #content-frame {
    display: none;
  }
</style>

<div id="loading-indicator" class="loading-bar" style="display: none;"></div>

<div class="filter-container">
  <div class="filter-box mb-8">
    <div class="filter-options flex flex-wrap gap-2">
      {# Ensure flex and gap for spacing #}
      {# Use DaisyUI button classes #}
      <a href="javascript:void(0)"
        data-filter="all"
        data-url="{% url 'gear:home' %}?filter=all"
        class="filter-button btn btn-sm {% if not filter or filter == 'all' %}
          
          
          
          
          btn-success




        {% else %}
          
          
          
          
          btn-outline




        {% endif %}"
        onclick="changeFilter(this)">
        All
      </a>

      <a href="javascript:void(0)"
        data-filter="items"
        data-url="{% url 'gear:home' %}?filter=items"
        class="filter-button btn btn-sm {% if filter == 'items' %}
          
          
          
          
          btn-success




        {% else %}
          
          
          
          
          btn-outline




        {% endif %}"
        onclick="changeFilter(this)">
        Items
      </a>

      <a href="javascript:void(0)"
        data-filter="collections"
        data-url="{% url 'gear:home' %}?filter=collections"
        class="filter-button btn btn-sm {% if filter == 'collections' %}
          
          
          
          
          btn-success




        {% else %}
          
          
          
          
          btn-outline




        {% endif %}"
        onclick="changeFilter(this)">
        Collections
      </a>

      <a href="javascript:void(0)"
        data-filter="libraries"
        data-url="{% url 'gear:home' %}?filter=libraries"
        class="filter-button btn btn-sm {% if filter == 'libraries' %}
          
          
          
          
          btn-success




        {% else %}
          
          
          
          
          btn-outline




        {% endif %}"
        onclick="changeFilter(this)">
        Libraries
      </a>
    </div>
  </div>
</div>

<!-- Hidden iframe to handle navigation without browser loading indicator -->
<iframe id="content-frame" name="content-frame" onload="handleFrameLoad()"></iframe>

<script>
  // When the document loads, capture the current state
  document.addEventListener('DOMContentLoaded', function () {
    // Store initial page content
    window.initialPageContent = document.getElementById('main-content') ? document.getElementById('main-content').innerHTML : document.body.innerHTML
  })
  
  function showLoading() {
    const loadingIndicator = document.getElementById('loading-indicator')
    loadingIndicator.style.display = 'block'
  }
  
  function hideLoading() {
    const loadingIndicator = document.getElementById('loading-indicator')
    loadingIndicator.style.display = 'none'
  }
  
  function changeFilter(element) {
    // Prevent default navigation
    event.preventDefault()
  
    // Get filter and URL
    const filterType = element.getAttribute('data-filter')
    const url = element.getAttribute('data-url')
  
    // Show loading bar
    showLoading()
  
    // Set active class using DaisyUI classes
    document.querySelectorAll('.filter-button').forEach((button) => {
      button.classList.remove('btn-success')
      button.classList.add('btn-outline')
    })
    element.classList.remove('btn-outline')
    element.classList.add('btn-success')
  
    // Update URL without page reload
    window.history.pushState({ filter: filterType }, '', url)
  
    // Use fetch to get the content
    fetch(url, {
      headers: {
        'X-Requested-With': 'XMLHttpRequest'
      }
    })
      .then((response) => response.text())
      .then((html) => {
        // Parse the HTML
        const parser = new DOMParser()
        const doc = parser.parseFromString(html, 'text/html')
  
        // Find the content to update
        const mainContent = doc.getElementById('main-content')
  
        // Update the content
        if (mainContent) {
          document.getElementById('main-content').innerHTML = mainContent.innerHTML
        } else {
          // Fallback for different content structure
          const contentArea = document.querySelector('.content-area') || document.querySelector('main')
          if (contentArea) {
            const newContentArea = doc.querySelector('.content-area') || doc.querySelector('main')
            if (newContentArea) {
              contentArea.innerHTML = newContentArea.innerHTML
            }
          }
        }
  
        // Hide the loading indicator
        hideLoading()
      })
      .catch((error) => {
        console.error('Error fetching content:', error)
        hideLoading()
  
        // In case of error, just navigate to the page
        window.location.href = url
      })
  }
  
  function handleFrameLoad() {
    hideLoading() // Hide loading indicator when frame finishes loading (fallback)
  }
</script>
